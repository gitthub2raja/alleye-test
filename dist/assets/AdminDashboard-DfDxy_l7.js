const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardView-QsleX4HH.js","assets/index-B1M48IIc.js","assets/index-CPRDUuem.css","assets/constants-B3wzPNvo.js","assets/ContentManagementView-BvwhDzkP.js","assets/DataTable-DFi--VBt.js","assets/ViewHeader-0is57CUg.js","assets/Modal-C23alaOS.js","assets/PlaylistManagementView-CMOH6CDF.js","assets/ThreatIntelView-D2jc9lGU.js","assets/OrganizationManagementView-CHITzEbk.js","assets/UserManagementView-1Tl50r5E.js","assets/QAManagementView-B6Uso0S8.js","assets/AnalyticsView-CQyUmrqx.js","assets/xapiLrsClient-D85D4vVW.js","assets/CartesianChart-CO1LtEG5.js","assets/LineChart-Ctb9MifT.js","assets/ActivePoints-BaaZkCC_.js","assets/ErrorBarContext-CB_ye9vW.js","assets/getRadiusAndStrokeWidthFromDot-DKg59sKC.js","assets/tooltipContext-zWB7JqEP.js","assets/CartesianGrid-BU5XHtoG.js","assets/XAxis-DF_0Vgkl.js","assets/YAxis-CJyeSg_n.js","assets/PieChart-C0UqHiLm.js","assets/PolarChart-BD4rHRBZ.js","assets/BarChart-DGhtXMDn.js","assets/barSelectors-BauBNM_w.js","assets/ProfileView-CTeoj4i1.js","assets/LogoutButton-Cqu2mkIg.js"])))=>i.map(i=>d[i]);
import{r as o,s as r,j as a,_ as m}from"./index-B1M48IIc.js";import{H as F,C as G,P as J,N as K,O as X,U as Z,Q as ee,A as te,a as ne,M as se}from"./constants-B3wzPNvo.js";const O=o.lazy(()=>m(()=>import("./DashboardView-QsleX4HH.js"),__vite__mapDeps([0,1,2,3]))),ae=o.lazy(()=>m(()=>import("./ContentManagementView-BvwhDzkP.js"),__vite__mapDeps([4,1,2,5,6,7]))),ie=o.lazy(()=>m(()=>import("./PlaylistManagementView-CMOH6CDF.js"),__vite__mapDeps([8,1,2,6,5,7]))),oe=o.lazy(()=>m(()=>import("./ThreatIntelView-D2jc9lGU.js"),__vite__mapDeps([9,1,2,6,5,7]))),re=o.lazy(()=>m(()=>import("./OrganizationManagementView-CHITzEbk.js"),__vite__mapDeps([10,1,2,6,5,7]))),ce=o.lazy(()=>m(()=>import("./UserManagementView-1Tl50r5E.js"),__vite__mapDeps([11,1,2,6,5,7]))),le=o.lazy(()=>m(()=>import("./QAManagementView-B6Uso0S8.js"),__vite__mapDeps([12,1,2,6,7]))),de=o.lazy(()=>m(()=>import("./AnalyticsView-CQyUmrqx.js"),__vite__mapDeps([13,1,2,6,14,15,16,17,18,19,20,21,22,23,24,25,26,27,5]))),ue=o.lazy(()=>m(()=>import("./ProfileView-CTeoj4i1.js"),__vite__mapDeps([28,1,2,29]))),fe=d=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",strokeWidth:1.5,stroke:"currentColor",...d,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"})}),me=d=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",strokeWidth:1.5,stroke:"currentColor",...d,children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"})}),we=({theme:d,toggleTheme:v})=>a.jsx("button",{onClick:v,className:"w-full flex items-center justify-center p-2 rounded-lg text-text-secondary hover:bg-sidebar-accent transition-colors","aria-label":`Switch to ${d==="light"?"dark":"light"} mode`,children:d==="light"?a.jsx(me,{className:"w-6 h-6"}):a.jsx(fe,{className:"w-6 h-6"})}),pe=({currentUser:d,onLogout:v,theme:U,toggleTheme:M})=>{const[x,I]=o.useState("Dashboard"),[A,j]=o.useState(!0),[C,N]=o.useState(!0),[he,S]=o.useState(!1),[D,w]=o.useState([]),[z,g]=o.useState([]),[k,h]=o.useState([]),[q,b]=o.useState([]),[T,p]=o.useState([]),[Q,L]=o.useState([]),[$,P]=o.useState([]),[B,y]=o.useState([]),[R,E]=o.useState({userCount:0,contentCount:0,playlistCount:0,organizationCount:0}),[V,H]=o.useState(0),[u,f]=o.useState({content:!1,playlists:!1,updates:!1,organizations:!1,users:!1,qanda:!1,analytics:!1});o.useEffect(()=>{(async()=>{N(!0);const[s,e,t,n,i,l]=await Promise.all([r.from("profiles").select("id",{count:"exact",head:!0}),r.from("content").select("id",{count:"exact",head:!0}),r.from("playlists").select("id",{count:"exact",head:!0}),r.from("organizations").select("id",{count:"exact",head:!0}),r.from("news").select("*, author:profiles(name)").order("created_at",{ascending:!1}).limit(3),r.from("qanda").select("id",{count:"exact",head:!0}).is("answer",null)]);E({userCount:s.count??0,contentCount:e.count??0,playlistCount:t.count??0,organizationCount:n.count??0}),i.data&&w(i.data.map(_=>({..._,author:_.author||{name:"Unknown"}}))),H(l.count??0),N(!1)})()},[]),o.useEffect(()=>{x!=="Dashboard"&&!C&&(async()=>{switch(S(!0),x){case"Content":if(!u.content){const{data:s}=await r.from("content").select("*").order("created_at",{ascending:!1});s&&g(s),f(e=>({...e,content:!0}))}break;case"Playlists":if(!u.playlists){const{data:s}=await r.from("playlists").select("*, playlist_content(content_id)").order("created_at",{ascending:!1});if(s){const e=s.map(t=>({...t,contentIds:t.playlist_content.map(n=>n.content_id),playlist_content:void 0}));b(e)}f(e=>({...e,playlists:!0}))}if(!u.content){const{data:s}=await r.from("content").select("*").order("created_at",{ascending:!1});s&&g(s),f(e=>({...e,content:!0}))}break;case"Threat Intel":if(!u.updates){const{data:s}=await r.from("news").select("*, author:profiles(name)").order("created_at",{ascending:!1});s&&w(s.map(e=>({...e,author:e.author||{name:"Unknown"}}))),f(e=>({...e,updates:!0}))}break;case"Organizations":if(!u.organizations){const{data:s}=await r.from("organizations").select("*");s&&p(s),f(e=>({...e,organizations:!0}))}if(!u.users){const{data:s}=await r.from("profiles").select("*");s&&h(s),f(e=>({...e,users:!0}))}break;case"Users":if(!u.users){const{data:s}=await r.from("profiles").select("*");s&&h(s),f(e=>({...e,users:!0}))}if(!u.organizations){const{data:s}=await r.from("organizations").select("*");s&&p(s),f(e=>({...e,organizations:!0}))}break;case"Q&A":if(!u.qanda){const{data:s}=await r.from("qanda").select("*, user:profiles(name, avatar_url), admin:profiles!answered_by(name)").order("created_at",{ascending:!1});s&&y(s),f(e=>({...e,qanda:!0}))}break;case"Analytics":if(!u.analytics){const[s,e]=await Promise.all([r.from("analytics").select("*").order("timestamp",{ascending:!1}),r.from("cyber_training_analytics").select("*").order("completed_at",{ascending:!1})]);s.data&&L(s.data),e.data&&P(e.data),f(t=>({...t,analytics:!0}))}if(!u.content){const{data:s}=await r.from("content").select("*");s&&g(e=>[...e,...s.filter(t=>!e.some(n=>n.id===t.id))]),f(e=>({...e,content:!0}))}if(!u.organizations){const{data:s}=await r.from("organizations").select("*");s&&p(s),f(e=>({...e,organizations:!0}))}if(!u.users){const{data:s}=await r.from("profiles").select("*");s&&h(s),f(e=>({...e,users:!0}))}break}S(!1)})()},[x,C]),o.useEffect(()=>{const c=[],s=(e,t)=>{const n=r.channel(`public:${e}`).on("postgres_changes",{event:"*",schema:"public",table:e},t).subscribe();c.push(n)};return s("analytics",e=>{e.eventType==="INSERT"&&L(t=>[e.new,...t])}),s("cyber_training_analytics",e=>{e.eventType==="INSERT"&&P(t=>[e.new,...t])}),s("profiles",e=>{e.eventType==="INSERT"?h(t=>[e.new,...t]):e.eventType==="UPDATE"?h(t=>t.map(n=>n.id===e.new.id?e.new:n)):e.eventType==="DELETE"&&h(t=>t.filter(n=>n.id!==e.old.id)),E(t=>({...t,userCount:e.eventType==="INSERT"?t.userCount+1:e.eventType==="DELETE"?t.userCount-1:t.userCount}))}),s("news",async e=>{const t=async n=>{const{data:i}=await r.from("profiles").select("name").eq("id",n.author_id).single();return{...n,author:i||{name:"Unknown"}}};if(e.eventType==="INSERT"){const n=await t(e.new);w(i=>[n,...i].sort((l,_)=>new Date(_.created_at).getTime()-new Date(l.created_at).getTime()))}else if(e.eventType==="UPDATE"){const n=await t(e.new);w(i=>i.map(l=>l.id===e.new.id?n:l))}else e.eventType==="DELETE"&&w(n=>n.filter(i=>i.id!==e.old.id))}),s("content",e=>{e.eventType==="INSERT"?g(t=>[e.new,...t]):e.eventType==="UPDATE"?g(t=>t.map(n=>n.id===e.new.id?e.new:n)):e.eventType==="DELETE"&&g(t=>t.filter(n=>n.id!==e.old.id)),E(t=>({...t,contentCount:e.eventType==="INSERT"?t.contentCount+1:e.eventType==="DELETE"?t.contentCount-1:t.contentCount}))}),s("playlists",async e=>{const t=async n=>{const{data:i}=await r.from("playlist_content").select("content_id").eq("playlist_id",n.id);return{...n,contentIds:(i==null?void 0:i.map(l=>l.content_id))||[]}};if(e.eventType==="INSERT"){const n=await t(e.new);b(i=>[n,...i])}else if(e.eventType==="UPDATE"){const n=await t(e.new);b(i=>i.map(l=>l.id===e.new.id?n:l))}else e.eventType==="DELETE"&&b(n=>n.filter(i=>i.id!==e.old.id));e.eventType!=="UPDATE"&&E(n=>({...n,playlistCount:e.eventType==="INSERT"?n.playlistCount+1:e.eventType==="DELETE"?n.playlistCount-1:n.playlistCount}))}),s("organizations",e=>{e.eventType==="INSERT"?p(t=>[e.new,...t]):e.eventType==="UPDATE"?p(t=>t.map(n=>n.id===e.new.id?e.new:n)):e.eventType==="DELETE"&&p(t=>t.filter(n=>n.id!==e.old.id)),E(t=>({...t,organizationCount:e.eventType==="INSERT"?t.organizationCount+1:e.eventType==="DELETE"?t.organizationCount-1:t.organizationCount}))}),s("qanda",async e=>{const t=async n=>{const{data:i}=await r.from("profiles").select("name, avatar_url").eq("id",n.user_id).single(),{data:l}=n.answered_by?await r.from("profiles").select("name").eq("id",n.answered_by).single():{data:null};return{...n,user:i,admin:l}};if(e.eventType==="INSERT"){const n=await t(e.new);y(i=>[n,...i].sort((l,_)=>new Date(_.created_at).getTime()-new Date(l.created_at).getTime()))}else if(e.eventType==="UPDATE"){const n=await t(e.new);y(i=>i.map(l=>l.id===e.new.id?n:l))}else e.eventType==="DELETE"&&y(n=>n.filter(i=>i.id!==e.old.id))}),()=>{c.forEach(e=>r.removeChannel(e))}},[]);const W=()=>{let c=null;switch(x){case"Dashboard":c=a.jsx(O,{currentUser:d,stats:R,updates:D,setUpdates:w,pendingQandaCount:V,setActiveView:I});break;case"Content":c=a.jsx(ae,{content:z,setContent:g,currentUser:d,allOrganizations:T});break;case"Playlists":c=a.jsx(ie,{playlists:q,setPlaylists:b,allContent:z,currentUser:d,allOrganizations:T});break;case"Threat Intel":c=a.jsx(oe,{updates:D,setUpdates:w,currentUser:d});break;case"Organizations":c=a.jsx(re,{organizations:T,setOrganizations:p,users:k,setUsers:h});break;case"Users":c=a.jsx(ce,{users:k,setUsers:h,organizations:T,currentUser:d});break;case"Q&A":c=a.jsx(le,{qandaItems:B,currentUser:d});break;case"Analytics":c=a.jsx(de,{analytics:Q,cyberAnalytics:$,content:z,organizations:T,users:k});break;case"Profile":c=a.jsx(ue,{user:d,onLogout:v});break;default:c=a.jsx(O,{currentUser:d,stats:R,updates:D,setUpdates:w,pendingQandaCount:V,setActiveView:I})}return a.jsx(o.Suspense,{fallback:a.jsxs("div",{className:"flex h-full w-full items-center justify-center",children:["Loading ",x,"..."]}),children:c})},Y=[{name:"Dashboard",icon:F},{name:"Content",icon:G},{name:"Playlists",icon:J},{name:"Threat Intel",icon:K},{name:"Organizations",icon:X},{name:"Users",icon:Z},{name:"Q&A",icon:ee},{name:"Analytics",icon:te},{name:"Profile",icon:ne}];return a.jsxs("div",{className:"flex h-screen bg-background text-text-main",children:[a.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden ${A?"block":"hidden"}`,onClick:()=>j(!1)}),a.jsxs("aside",{className:`w-64 flex-shrink-0 bg-sidebar border-r border-border flex flex-col fixed inset-y-0 left-0 z-30 md:relative md:translate-x-0 transform ${A?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out`,children:[a.jsx("div",{className:"h-16 flex items-center justify-center px-4 border-b border-border",children:a.jsx("h1",{className:"text-xl font-bold text-text-main",children:"ALL EYE"})}),a.jsx("nav",{className:"flex-1 p-4 space-y-2",children:Y.map(c=>a.jsxs("button",{onClick:()=>{I(c.name),j(!1)},className:`w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-colors ${x===c.name?"bg-primary/20 text-primary":"text-text-secondary hover:bg-sidebar-accent"}`,children:[a.jsx(c.icon,{className:"mr-3 h-5 w-5"}),a.jsx("span",{children:c.name})]},c.name))}),a.jsx("div",{className:"p-4 border-t border-border",children:a.jsx(we,{theme:U,toggleTheme:M})})]}),a.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[a.jsxs("header",{className:"h-16 bg-sidebar/50 backdrop-blur-md border-b border-border flex items-center px-4 md:hidden sticky top-0 z-10 flex-shrink-0",children:[a.jsx("button",{onClick:()=>j(!0),className:"text-gray-500",children:a.jsx(se,{className:"h-6 w-6"})}),a.jsx("h2",{className:"ml-4 font-semibold text-lg",children:x})]}),a.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto",children:C?a.jsx("div",{className:"flex h-full w-full items-center justify-center",children:a.jsx("p",{children:"Loading your dashboard..."})}):a.jsx("div",{className:"max-w-7xl mx-auto",children:W()})})]})]})};export{pe as default};
