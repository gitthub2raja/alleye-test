const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PowerBiView-CSac_wm1.js","assets/index-jQJV2EFP.js","assets/index-CPRDUuem.css","assets/ViewHeader-CXWrgE1L.js","assets/ThreatIntelView-w2zh7Edt.js","assets/TeamManagementView-Cb_Ky_jP.js","assets/DataTable-BD20IEWZ.js","assets/Modal-CcdrESRI.js","assets/ContentAssignmentView-D5qCiFg-.js","assets/ActivityView-FFBx7XLp.js","assets/AnalyticsView-BO7NZX0J.js","assets/xapiLrsClient-D85D4vVW.js","assets/CartesianChart-B_BrNQmb.js","assets/LineChart-CCa0ZC3h.js","assets/ActivePoints-CSHEL4ag.js","assets/ErrorBarContext-BZTJQn7L.js","assets/getRadiusAndStrokeWidthFromDot-0ypLIYJB.js","assets/tooltipContext-C27L6kvg.js","assets/CartesianGrid-DMk2tGFt.js","assets/XAxis-Dlu08YPE.js","assets/YAxis-Cu9Smy0G.js","assets/PieChart-D41iAqCF.js","assets/PolarChart-3AcSlJFm.js","assets/BarChart-DJFnejGI.js","assets/barSelectors-BUV5HdgF.js","assets/QAView-Nxyty5k4.js","assets/FaqContent-MIH4tJ1F.js","assets/ProfileView-DOfevRJt.js","assets/LogoutButton-ug9XX9ug.js"])))=>i.map(i=>d[i]);
import{r as n,s as c,j as e,_ as h}from"./index-jQJV2EFP.js";import{b as U,H as ee,N as ae,U as te,C as se,P as ne,c as ie,A as oe,Q as le,a as re,M as ce}from"./constants-B1pOV21M.js";const z=n.lazy(()=>h(()=>import("./PowerBiView-CSac_wm1.js"),__vite__mapDeps([0,1,2,3]))),de=n.lazy(()=>h(()=>import("./ThreatIntelView-w2zh7Edt.js"),__vite__mapDeps([4,1,2]))),me=n.lazy(()=>h(()=>import("./TeamManagementView-Cb_Ky_jP.js"),__vite__mapDeps([5,1,2,6,7]))),R=n.lazy(()=>h(()=>import("./ContentAssignmentView-D5qCiFg-.js"),__vite__mapDeps([8,1,2,3,6,7]))),fe=n.lazy(()=>h(()=>import("./ActivityView-FFBx7XLp.js"),__vite__mapDeps([9,1,2,3,6,7]))),ue=n.lazy(()=>h(()=>import("./AnalyticsView-BO7NZX0J.js"),__vite__mapDeps([10,1,2,3,11,12,13,14,15,16,17,18,19,20,21,22,23,24,6]))),_e=n.lazy(()=>h(()=>import("./QAView-Nxyty5k4.js"),__vite__mapDeps([25,1,2,3,26]))),he=n.lazy(()=>h(()=>import("./ProfileView-DOfevRJt.js"),__vite__mapDeps([27,1,2,28]))),ye=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",strokeWidth:1.5,stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"})}),xe=t=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",strokeWidth:1.5,stroke:"currentColor",...t,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"})}),pe=({theme:t,toggleTheme:d})=>e.jsx("button",{onClick:d,className:"w-full flex items-center justify-center p-2 rounded-lg text-text-secondary hover:bg-sidebar-accent transition-colors","aria-label":`Switch to ${t==="light"?"dark":"light"} mode`,children:t==="light"?e.jsx(xe,{className:"w-6 h-6"}):e.jsx(ye,{className:"w-6 h-6"})}),we=({currentUser:t,organization:d,onLogout:q,theme:$,toggleTheme:M})=>{const[m,O]=n.useState("Dashboard"),[E,w]=n.useState(!0),[D,j]=n.useState(!0),[Q,N]=n.useState(!1),[u,L]=n.useState([]),[v,k]=n.useState([]),[p,P]=n.useState([]),[B,g]=n.useState([]),[I,H]=n.useState([]),[F,V]=n.useState([]),[W,S]=n.useState([]),[G,J]=n.useState([]),[A,C]=n.useState([]),[y,x]=n.useState({content:!1,playlists:!1,analytics:!1,qanda:!1,teams:!1});n.useEffect(()=>{(async()=>{if(!t.organization_id){j(!1);return}j(!0);try{const{data:f}=await c.from("profiles").select("*").eq("organization_id",t.organization_id),a=f||[];L(a);const i=a.map(_=>_.id),[l,o,r]=await Promise.all([c.from("news").select("*, author:profiles(name)").order("created_at",{ascending:!1}),c.from("teams").select("*").eq("organization_id",t.organization_id),i.length>0?c.from("user_assignments").select("*").in("user_id",i):Promise.resolve({data:[]})]);l.data&&g(l.data.map(_=>({..._,author:_.author||{name:"Unknown"}}))),o.data&&k(o.data),r.data&&C(r.data)}catch(f){console.error("Error fetching initial lead data:",f)}finally{j(!1)}})()},[t.organization_id]),n.useEffect(()=>{(async()=>{if(!t.organization_id)return;N(!0);const f=`or(assigned_org_ids.is.null,assigned_org_ids.eq.{},assigned_org_ids.cs.{${t.organization_id}})`;try{switch(m){case"Content Library":case"Playlists":if(!y.content){const{data:a}=await c.from("content").select("*").or(f);a&&P(a),x(i=>({...i,content:!0}))}if(!y.playlists){const{data:a}=await c.from("playlists").select("*, playlist_content(content_id)").or(f);if(a){const i=a.map(l=>({...l,contentIds:l.playlist_content.map(o=>o.content_id)}));H(i)}x(i=>({...i,playlists:!0}))}break;case"Analytics":if(!y.analytics){const a=u.map(o=>o.id),[i,l]=await Promise.all([a.length>0?c.from("analytics").select("*").in("user_id",a):Promise.resolve({data:[]}),c.from("cyber_training_analytics").select("*").eq("user_company",t.company)]);if(i.data&&V(i.data),l.data&&S(l.data),!y.content){const{data:o}=await c.from("content").select("*").or(f);o&&P(r=>[...r,...o.filter(_=>!r.some(Z=>Z.id===_.id))]),x(r=>({...r,content:!0}))}x(o=>({...o,analytics:!0}))}break;case"Q&A":if(!y.qanda){const{data:a}=await c.from("qanda").select("*, user:profiles(name, avatar_url), admin:profiles!answered_by(name)").or(`is_faq.eq.true,user:organization_id.eq.${t.organization_id}`).order("created_at",{ascending:!1});a&&J(a),x(i=>({...i,qanda:!0}))}break}}catch(a){console.error(`Error loading data for ${m}:`,a)}finally{N(!1)}})()},[m,t,u,y]),n.useEffect(()=>{if(!t.organization_id)return;const s=u.map(a=>a.id),f=c.channel(`lead-dashboard-realtime-${t.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"analytics",filter:`user_id=in.(${s.join(",")})`},a=>{const i=a.new;V(l=>[i,...l].sort((o,r)=>new Date(r.timestamp).getTime()-new Date(o.timestamp).getTime()))}).on("postgres_changes",{event:"INSERT",schema:"public",table:"cyber_training_analytics",filter:`user_company=eq.${t.company}`},a=>{const i=a.new;S(l=>[i,...l].sort((o,r)=>new Date(r.completed_at).getTime()-new Date(o.completed_at).getTime()))}).on("postgres_changes",{event:"*",schema:"public",table:"profiles",filter:`organization_id=eq.${t.organization_id}`},async()=>{const{data:a}=await c.from("profiles").select("*").eq("organization_id",t.organization_id);a&&L(a)}).on("postgres_changes",{event:"*",schema:"public",table:"teams",filter:`organization_id=eq.${t.organization_id}`},async()=>{const{data:a}=await c.from("teams").select("*").eq("organization_id",t.organization_id);a&&k(a)}).on("postgres_changes",{event:"*",schema:"public",table:"user_assignments",filter:`user_id=in.(${s.join(",")})`},async a=>{if(s.length>0){const{data:i}=await c.from("user_assignments").select("*").in("user_id",s);i&&C(i)}}).on("postgres_changes",{event:"*",schema:"public",table:"news"},async a=>{const i=async l=>{const{data:o}=await c.from("profiles").select("name").eq("id",l.author_id).single();return{...l,author:o||{name:"Unknown"}}};if(a.eventType==="INSERT"){const l=await i(a.new);g(o=>[l,...o].sort((r,_)=>new Date(_.created_at).getTime()-new Date(r.created_at).getTime()))}else if(a.eventType==="UPDATE"){const l=await i(a.new);g(o=>o.map(r=>r.id===a.new.id?l:r))}else a.eventType==="DELETE"&&g(l=>l.filter(o=>o.id!==a.old.id))}).subscribe();return()=>{c.removeChannel(f)}},[u,t.id,t.company,t.organization_id]);const b=n.useMemo(()=>u.filter(s=>s.id!==t.id),[u,t.id]),T=(d==null?void 0:d.theme_color)||"var(--secondary-color)",K=()=>{if(Q&&!D)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsxs("p",{children:["Loading ",m,"..."]})});let s=null;switch(m){case"Dashboard":s=e.jsx(z,{organization:d});break;case"Threat Intel":s=e.jsx(de,{updates:B});break;case"Team Management":s=e.jsx(me,{users:u,teams:v,setTeams:k,currentUser:t});break;case"Content Library":s=e.jsx(R,{users:b,content:p,playlists:I,currentUser:t,teams:v,initialView:"content",userAssignments:A});break;case"Playlists":s=e.jsx(R,{users:b,content:p,playlists:I,currentUser:t,teams:v,initialView:"playlists",userAssignments:A});break;case"Activity":s=e.jsx(fe,{users:b,content:p,playlists:I,userAssignments:A});break;case"Analytics":s=e.jsx(ue,{teamUsers:b,teamAnalytics:F,teamCyberAnalytics:W,allContent:p,allUsers:u,organization:d});break;case"Q&A":s=e.jsx(_e,{qandaItems:G});break;case"Profile":s=e.jsx(he,{user:t,onLogout:q});break;default:s=e.jsx(z,{organization:d})}return e.jsx(n.Suspense,{fallback:e.jsxs("div",{className:"flex h-full w-full items-center justify-center",children:["Loading ",m,"..."]}),children:s})},X=[{name:"Dashboard",icon:ee},{name:"Threat Intel",icon:ae},{name:"Team Management",icon:te},{name:"Content Library",icon:se},{name:"Playlists",icon:ne},{name:"Activity",icon:ie},{name:"Analytics",icon:oe},{name:"Q&A",icon:le},{name:"Profile",icon:re}],Y={backgroundColor:`${T}33`,color:T};return e.jsxs("div",{className:"flex h-screen bg-background text-text-main",children:[e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden ${E?"block":"hidden"}`,onClick:()=>w(!1)}),e.jsxs("aside",{className:`w-64 flex-shrink-0 bg-sidebar border-r border-border flex flex-col fixed inset-y-0 left-0 z-30 md:relative md:translate-x-0 transform ${E?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out`,children:[e.jsx("div",{className:"h-16 flex items-center justify-center px-4 border-b border-border",children:d!=null&&d.logo_url?e.jsx("img",{src:d.logo_url,alt:d.name,className:"h-10 max-w-full object-contain"}):e.jsx(U,{className:"text-text-main h-8"})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:X.map(s=>e.jsxs("button",{onClick:()=>{O(s.name),w(!1)},className:`w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-colors ${m!==s.name?"text-text-secondary hover:bg-sidebar-accent":""}`,style:m===s.name?Y:{},children:[e.jsx(s.icon,{className:"mr-3 h-5 w-5"}),e.jsx("span",{children:s.name})]},s.name))}),e.jsx("div",{className:"p-4 border-t border-border",children:e.jsx(pe,{theme:$,toggleTheme:M})})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"h-16 bg-sidebar/50 backdrop-blur-md border-b border-border flex items-center px-4 md:hidden sticky top-0 z-10 flex-shrink-0",children:[e.jsx("button",{onClick:()=>w(!0),className:"text-gray-400",children:e.jsx(ce,{className:"h-6 w-6"})}),e.jsx("h2",{className:"ml-4 font-semibold text-lg",children:m})]}),e.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto",children:D?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx("p",{children:"Loading your dashboard..."})}):e.jsx("div",{className:"max-w-7xl mx-auto",children:K()})})]}),e.jsx("style",{children:`
                .btn-primary-themed {
                    background-color: ${T};
                    color: black;
                }
                .btn-primary-themed:hover {
                    opacity: 0.9;
                }
            `})]})};export{we as default};
