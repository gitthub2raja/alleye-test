const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ExecutiveSummaryView-Bgx-h6AI.js","assets/index-D0LKihWx.js","assets/index-CPRDUuem.css","assets/CustomTooltip-DlO-oJUW.js","assets/Gauge-eSJOTq9G.js","assets/CartesianChart-XZ9oN6o3.js","assets/PieChart-o5d90sGq.js","assets/tooltipContext-Dsaq1-x6.js","assets/PolarChart-C5R0AQBq.js","assets/LineChart-DOCE-dDr.js","assets/ActivePoints-C5OEKP8z.js","assets/ErrorBarContext-Dcs2wgOg.js","assets/getRadiusAndStrokeWidthFromDot-DGHXVsRS.js","assets/EngagementView-CUpRU5G6.js","assets/BarChart-Dr8KpdKm.js","assets/XAxis-cwaU9eXC.js","assets/barSelectors-6VLD7Q4g.js","assets/YAxis-Bsetyn0C.js","assets/EffectivenessView-CVHuD6_l.js","assets/RadarChart-7kSOEFiM.js","assets/BehavioralIntelView-abGdWZiH.js","assets/ComplianceView-a4YLKFs4.js","assets/AreaChart-CZMYaPeB.js","assets/RoiView-B59zudWJ.js","assets/DrillDownView-BUt6IS8K.js","assets/PowerBiView-CCrb0tfM.js"])))=>i.map(i=>d[i]);
import{j as s,r as c,s as h,B as we,_}from"./index-D0LKihWx.js";import{f as ye}from"./xapiLrsClient-D85D4vVW.js";import{M as je}from"./Modal-BcWOlSgM.js";import{D as Y}from"./DataTable-DsP_0w7v.js";const De=l=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",strokeWidth:1.5,stroke:"currentColor",...l,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"})}),Se=l=>s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",strokeWidth:1.5,stroke:"currentColor",...l,children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"})}),Me=({theme:l,toggleTheme:n})=>s.jsx("button",{onClick:n,className:"p-2 rounded-full text-text-secondary hover:bg-sidebar-accent transition-colors","aria-label":`Switch to ${l==="light"?"dark":"light"} mode`,children:l==="light"?s.jsx(Se,{className:"w-5 h-5"}):s.jsx(De,{className:"w-5 h-5"})}),Ee=({isOpen:l,onClose:n,modalType:M,data:w})=>{const N=c.useMemo(()=>{if(!l)return null;const V=()=>{const b=w.xapiStatements.filter(m=>{var r;return m.verb.id.includes("answered")&&((r=m.result)==null?void 0:r.success)===!1}),u={};return b.forEach(m=>{var R,i;const r=((i=(R=m.object.definition)==null?void 0:R.name)==null?void 0:i["en-US"])||"Unknown Concept";u[r]=(u[r]||0)+1}),Object.entries(u).map(([m,r])=>({id:m,concept:m,count:r})).sort((m,r)=>r.count-m.count)};switch(M){case"Learning Effectiveness":return s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-lg mb-4",children:"Top Missed Concepts"}),s.jsx("p",{className:"text-sm text-text-secondary mb-4",children:"Based on incorrect quiz answers from xAPI data."}),s.jsx(Y,{columns:[{key:"concept",header:"Quiz Question / Concept"},{key:"count",header:"Incorrect Answers"}],data:V()})]});case"Behavioral Intelligence":return s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-lg mb-4",children:"Departmental Score Breakdown"}),s.jsx(Y,{columns:[{key:"name",header:"Department"},{key:"score",header:"Average Score (%)"}],data:w.behavioralData.departmentalScores})]});case"Governance & Compliance":return s.jsxs("div",{children:[s.jsx("h4",{className:"font-bold text-lg mb-4",children:"Compliance Training Status"}),s.jsx(Y,{columns:[{key:"control",header:"Compliance Control"},{key:"rate",header:"Completion Rate (%)",render:b=>b.rate.toFixed(1)+"%"}],data:w.complianceData.controlCoverage})]});default:return s.jsx("p",{children:"Detailed insight for this section is not yet available."})}},[l,M,w]);return s.jsx(je,{isOpen:l,onClose:n,title:`Detailed Insight: ${M}`,size:"xl",children:N})},Ce=c.lazy(()=>_(()=>import("./ExecutiveSummaryView-Bgx-h6AI.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]))),Ie=c.lazy(()=>_(()=>import("./EngagementView-CUpRU5G6.js"),__vite__mapDeps([13,1,2,3,5,14,15,16,7,11,17]))),ke=c.lazy(()=>_(()=>import("./EffectivenessView-CVHuD6_l.js"),__vite__mapDeps([18,1,2,3,5,19,10,8,14,15,16,7,11]))),Te=c.lazy(()=>_(()=>import("./BehavioralIntelView-abGdWZiH.js"),__vite__mapDeps([20,1,2,3,5,14,17,15,16,7,11,9,10,12]))),Ae=c.lazy(()=>_(()=>import("./ComplianceView-a4YLKFs4.js"),__vite__mapDeps([21,1,2,3,4,5,6,7,8,22,10,12,15]))),Le=c.lazy(()=>_(()=>import("./RoiView-B59zudWJ.js"),__vite__mapDeps([23,1,2,3,5,15,17,16,7,11,9,10,12]))),Oe=c.lazy(()=>_(()=>import("./DrillDownView-BUt6IS8K.js"),__vite__mapDeps([24,1,2]))),Re=c.lazy(()=>_(()=>import("./PowerBiView-CCrb0tfM.js"),__vite__mapDeps([25,1,2]))),Qe=({currentUser:l,organization:n,onLogout:M,theme:w,toggleTheme:N})=>{const[V,b]=c.useState(!0),[u,m]=c.useState([]),[r,R]=c.useState([]),[i,Z]=c.useState([]),[d,z]=c.useState([]),[ee,te]=c.useState([]),[f,se]=c.useState("Executive Summary"),[H,K]=c.useState(null);c.useEffect(()=>{const a=async()=>{var y,j;if(!n){b(!1);return}b(!0);try{const v=`or(assigned_org_ids.is.null,assigned_org_ids.eq.{},assigned_org_ids.cs.{${n.id}})`,[C,P,B,Q,U]=await Promise.all([h.from("profiles").select("*").eq("organization_id",n.id),h.from("content").select("*").or(v),h.from("analytics").select("*").in("user_id",((y=(await h.from("profiles").select("id").eq("organization_id",n.id)).data)==null?void 0:y.map(x=>x.id))||[]),h.from("cyber_training_analytics").select("*").in("user_id",((j=(await h.from("profiles").select("id").eq("organization_id",n.id)).data)==null?void 0:j.map(x=>x.id))||[]),ye({})]),D=C.data||[];m(D),R(P.data||[]),Z(B.data||[]),z(Q.data||[]);const I=new Set(D.map(x=>`mailto:${x.email}`));te(U.filter(x=>I.has(x.actor.mbox)))}catch(v){console.error("Error fetching CISO dashboard data:",v)}finally{b(!1)}};a();const E=[h.channel(`ciso-profiles-${n==null?void 0:n.id}`).on("postgres_changes",{event:"*",schema:"public",table:"profiles",filter:`organization_id=eq.${n==null?void 0:n.id}`},a).subscribe(),h.channel(`ciso-content-${n==null?void 0:n.id}`).on("postgres_changes",{event:"*",schema:"public",table:"content"},a).subscribe(),h.channel(`ciso-analytics-${n==null?void 0:n.id}`).on("postgres_changes",{event:"*",schema:"public",table:"analytics"},a).subscribe()];return()=>{E.forEach(y=>h.removeChannel(y))}},[n]);const $=c.useMemo(()=>{const a=new Set(r.filter(e=>{var t;return((t=e.compliance)==null?void 0:t.length)>0}).map(e=>e.id)),E=new Date;E.setDate(E.getDate()-30);const y=new Set(i.filter(e=>new Date(e.timestamp)>E).map(e=>e.user_id)),j=u.length>0?Math.round(y.size/u.length*100):0,v=new Set(i.filter(e=>e.event_type==="start").map(e=>`${e.user_id}-${e.content_id}`)),C=new Set(i.filter(e=>e.event_type==="complete").map(e=>`${e.user_id}-${e.content_id}`)),P=v.size>0?Math.round(C.size/v.size*100):0,B=d.reduce((e,t)=>e+(t.score||0),0),Q=d.length>0?Math.round(B/d.length):0,U=Math.round(j*.4+P*.3+Q*.3),D=d.filter(e=>new Date(e.completed_at)>=new Date(new Date().setMonth(new Date().getMonth()-3))),I=d.filter(e=>new Date(e.completed_at)<new Date(new Date().setMonth(new Date().getMonth()-3))&&new Date(e.completed_at)>=new Date(new Date().setMonth(new Date().getMonth()-6))),x=D.length>0?D.reduce((e,t)=>e+t.score,0)/D.length:0,ae=I.length>0?I.reduce((e,t)=>e+t.score,0)/I.length:0,ce=Array.from(C).filter(e=>a.has(parseInt(e.split("-")[1]))).length,X=Array.from(v).filter(e=>a.has(parseInt(e.split("-")[1]))).length,ie=X>0?Math.round(ce/X*100):0,q={},le=new Set(r.filter(e=>e.type.toLowerCase().includes("video")).map(e=>e.id));i.filter(e=>e.event_type==="complete"&&le.has(e.content_id)).forEach(e=>{const t=new Date(e.timestamp).toLocaleString("default",{month:"short"});q[t]=(q[t]||0)+1});const de=Object.entries(q).map(([e,t])=>({month:e,count:t})),k={};i.forEach(e=>{k[e.content_id]||(k[e.content_id]={started:0,completed:0}),e.event_type==="start"&&k[e.content_id].started++,e.event_type==="complete"&&k[e.content_id].completed++});const me=Object.entries(k).map(([e,t])=>{var o;return{name:(((o=r.find(p=>p.id===parseInt(e)))==null?void 0:o.title)||"Unknown").substring(0,15),rate:t.started>0?Math.round(t.completed/t.started*100):0,started:t.started}}).sort((e,t)=>t.started-e.started).slice(0,5),T={};d.forEach(e=>{T[e.content_id]||(T[e.content_id]={totalTime:0,count:0}),T[e.content_id].totalTime+=e.video_watch_time,T[e.content_id].count++});const pe=Object.entries(T).map(([e,t])=>{var o;return{module:((o=r.find(p=>p.id===parseInt(e)))==null?void 0:o.title)||"Unknown",time:t.count>0?Math.round(t.totalTime/t.count):0}}).sort((e,t)=>t.time-e.time).slice(0,5),he=d.map(e=>e.score),S={"0-20":0,"21-40":0,"41-60":0,"61-80":0,"81-100":0};he.forEach(e=>{e<=20?S["0-20"]++:e<=40?S["21-40"]++:e<=60?S["41-60"]++:e<=80?S["61-80"]++:S["81-100"]++});const ue=Object.entries(S).map(([e,t])=>({name:e,count:t})),A={};d.forEach(e=>{var o;const t=((o=u.find(p=>p.id===e.user_id))==null?void 0:o.team)||"Unknown";A[t]||(A[t]={totalScore:0,count:0}),A[t].totalScore+=e.score,A[t].count++});const fe=Object.entries(A).map(([e,t])=>({id:e,name:e,score:t.count>0?Math.round(t.totalScore/t.count):0})).sort((e,t)=>t.score-e.score),W={};i.filter(e=>e.event_type==="complete").forEach(e=>{const t=new Date(e.timestamp).toLocaleString("default",{month:"short"});W[t]=(W[t]||0)+1});const xe=Object.entries(W).map(([e,t])=>({month:e,completions:t})),F={};i.filter(e=>e.event_type==="start").forEach(e=>{F[e.content_id]=(F[e.content_id]||0)+1});const ve=Object.entries(F).sort(([,e],[,t])=>t-e).slice(0,5).map(([e,t])=>{var o;return{name:((o=r.find(p=>p.id===parseInt(e)))==null?void 0:o.title)||"Unknown",views:t}}),G=[...new Set(r.flatMap(e=>e.compliance||[]))].map(e=>{const t=new Set(r.filter(g=>{var J;return(J=g.compliance)==null?void 0:J.includes(e)}).map(g=>g.id)),o=Array.from(C).filter(g=>t.has(parseInt(g.split("-")[1]))).length,p=Array.from(v).filter(g=>t.has(parseInt(g.split("-")[1]))).length;return{id:e,control:e,rate:p>0?o/p*100:0}}),_e=Math.round(G.reduce((e,t)=>e+t.rate,0)/(G.length||1)),L={};i.forEach(e=>{if(a.has(e.content_id)){const t=new Date(e.timestamp),o=`Q${Math.floor(t.getMonth()/3)+1} '${String(t.getFullYear()).slice(2)}`;L[o]||(L[o]={completed:0,started:0}),e.event_type==="start"&&L[o].started++,e.event_type==="complete"&&L[o].completed++}});const be=Object.entries(L).map(([e,t])=>({q:e,value:t.started>0?Math.round(t.completed/t.started*100):0})),O={};d.forEach(e=>{const t=new Date(e.completed_at),o=`Q${Math.floor(t.getMonth()/3)+1} '${String(t.getFullYear()).slice(2)}`;O[o]||(O[o]={totalScore:0,count:0}),O[o].totalScore+=e.score,O[o].count++});const ge=Object.entries(O).map(([e,t])=>({q:e,score:t.count>0?Math.round(t.totalScore/t.count):0}));return{executive:{bii:U,activeUserCoverageData:[{name:"Active",value:j},{name:"Inactive",value:100-j}],avgKnowledgeGain:[{name:"Last Q",value:Math.round(ae)},{name:"This Q",value:Math.round(x)}],complianceAlignment:ie},engagement:{videosWatched:de,completionRate:me,avgWatchTime:pe},effectiveness:{scoreDistribution:ue},behavioral:{departmentalScores:fe,fatigueIndex:xe,topContent:ve},compliance:{controlCoverage:G,auditReadiness:_e,alignmentTrend:be},roi:{cultureGrowth:ge}}},[u,r,i,d]),ne=()=>{},oe=["Executive Summary","Engagement","Effectiveness","Behavioral Intel","Compliance","ROI","Drill-Down","Power BI Dashboard"],re=()=>{const a={data:$,onInsightClick:K};return s.jsxs(c.Suspense,{fallback:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}),children:[f==="Executive Summary"&&s.jsx(Ce,{...a}),f==="Engagement"&&s.jsx(Ie,{...a}),f==="Effectiveness"&&s.jsx(ke,{...a}),f==="Behavioral Intel"&&s.jsx(Te,{...a}),f==="Compliance"&&s.jsx(Ae,{...a,onDownload:ne}),f==="ROI"&&s.jsx(Le,{...a}),f==="Drill-Down"&&s.jsx(Oe,{content:r,analytics:i,cyberAnalytics:d}),f==="Power BI Dashboard"&&s.jsx(Re,{organization:n})]})};return V?s.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:"Loading CISO Dashboard..."}):s.jsxs("div",{className:"flex flex-col h-screen bg-background font-sans",children:[s.jsx("style",{children:" .recharts-tooltip-cursor { stroke: var(--border-color); stroke-dasharray: 3 3; } .recharts-legend-item { font-size: 12px !important; color: var(--text-secondary-color) !important; } "}),s.jsxs("header",{className:"flex-shrink-0 bg-sidebar/50 backdrop-blur-md border-b border-border flex justify-between items-center px-4 sm:px-6 h-16 sticky top-0 z-10",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-bold text-text-main",children:"CISO Dashboard"}),s.jsxs("p",{className:"text-sm text-text-secondary",children:["Welcome, ",l.name]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Me,{theme:w,toggleTheme:N}),s.jsx(we,{variant:"danger",size:"sm",onClick:M,children:"Logout"})]})]}),s.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden",children:[s.jsx("div",{className:"flex-shrink-0 border-b border-border px-4 sm:px-6",children:s.jsx("nav",{className:"-mb-px flex space-x-6 overflow-x-auto","aria-label":"Tabs",children:oe.map(a=>s.jsx("button",{onClick:()=>se(a),className:`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors ${f===a?"border-primary text-primary":"border-transparent text-text-secondary hover:text-text-main hover:border-border"}`,children:a},a))})}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:re()})]}),s.jsx(Ee,{isOpen:!!H,onClose:()=>K(null),modalType:H,data:{xapiStatements:ee,profiles:u,content:r,cyberAnalytics:d,behavioralData:$.behavioral,complianceData:$.compliance}})]})};export{Qe as default};
